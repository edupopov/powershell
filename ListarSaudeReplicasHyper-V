# Este script mostra a saúde das réplicas de máquins virtuais entre dois servidores
# Criado por Eduardo Popovici
# 02-set-2025

Import-Module Hyper-V

$reps = Get-VMReplication

$report = $reps |
  Select-Object `
    @{n='VM';e={ if ($_.VMName) { $_.VMName } else { $_.Name } }},
    ReplicationState,
    ReplicationHealth,
    ReplicationMode,
    LastReplicationTime,
    PrimaryServer,
    ReplicaServer

$report | Sort-Object ReplicationHealth, ReplicationState, VM | Format-Table -AutoSize

$reps | Group-Object ReplicationHealth | Select-Object Name,Count
$reps | Group-Object ReplicationState  | Select-Object Name,Count

Get-VMReplicationServer |
  Select-Object ComputerName, AuthType, HttpPort, HttpsPort, DefaultStorageLocation |
  Format-List

# Exportar para csv
# $report | Export-Csv "C:\Temp\HyperV-Replica-Health.csv" -NoTypeInformation -Encoding UTF8
